{% load static %}
<html lang="fr">
    <head>
    <!--	<meta charset="UTF-8"> -->
        <meta charset="utf-8">
        <title>RésultatsG</title>
        <link rel="stylesheet" type="text/css" href="{% static 'projet/r.css' %}">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <style>
            table, th, td {
                border: 1px solid black;
            }
            .highlight {
               background-color: yellow;
            }
        </style>
        <style>
      
                span[class*=' genetotip'] span[class^='tooltiptext']{
                visibility: hidden;
                width: 120px;
                background-color: black;
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 5px 0;

                /* Position the tooltip */
                position: absolute;
                z-index: 1;
            }
            
            span[class^='genetotip'], span[class*=' genetotip']{
                position: relative;
                border-bottom: 1px dotted black;

            }
            
            span[class*=' genetotip']:hover span[class^='tooltiptext']{
                visibility: visible;
                }
        </style>
      
    </head>

    <body>
        <h1>Résultats Génome</h1>
        <form method="get" action="{% url 'projet:accueil' %}">

        {% if results_genomique %}


            {% for genome in results_genomique %}
            <H1  style="text-align:center">{{forloop.counter}} - {{genome.Id_genome}}</H1>

            <h2><strong>Résumé :</h2>

            <table style="border:1px solid black;margin-left:auto;margin-right:auto;">
                <tr>
                  <th>Espèce</th>
                  <th>Taille</th>
                </tr>
    
                <tr>
                    <td>{{genome.espece}}</td>
                    <td>{{genome.taille_sequence}}</td>
                </tr>
            </table>
    
            <h2><strong>Séquence :</h2>

            <div style="width:1800px;height:500px;line-height:3em;overflow:scroll;padding:5px;background-color: white  ;color:black  ; border: 2px solid green;">
            <p  id="sequence" style="word-wrap: break-word;">
            {{genome.sequence_genome}}
            </div>
            
            
            
            {% endfor %}

        </form>     
        <br><br>
        <button>Extraire</button>
        <br><br>
        <br><br>
        <legend><strong>Séquence Séléctionnée :</legend>
        <br><br>
        <p>Insérez dans le cadre dessous la séquence que vous voulez alignés, puis cliquer sur le boutton "Submit"</p>
        <br><br>
        <form action ="{% url 'projet:blast_results'%}" method="post">
            {% csrf_token %}
            <textarea name="sequence" style="border: 2px solid green;width: 100%;
            height: 150px;"></textarea>
            <br><br>
            <button type="submit">Submit</button>
        </form>
        
        {% else %}
            <p>Auncun génome n'a pu etre retrouvé avec votre requete, veuillez préciser votre recherche.</p>        
        {% endif %}
        "{{list_genes|json_script:'listGenes'}}"
    </body>

    <script>
        function highlight(list_genes) {
            var inputText = document.getElementById("sequence");
            var  innerHTML = inputText.innerHTML.replace(/ /g,'');
            var newInnerHTML = ""
            var span = ""
            for (let i = 0; i < list_genes.length; i++){
                start = list_genes[i].start
                end = list_genes[i].end
                
                //innerHTML = innerHTML.substring(0,start) + "<span class='highlight'>" + innerHTML.substring(start-1,end+1) + "</span>" + innerHTML.substring(end+1, innerHTML.length+1);
                /*console.log("i : " + i)
                console.log("start : " + start)
                console.log("end : " + end)
                console.log("innerHTML.length : " + innerHTML.length)
                console.log("newInnerHTML.length : " + newInnerHTML.length)
                console.log("newInnerHTML.length : " + newInnerHTML.length)*/
                if (i == 0){
                    span = "<span class='tooltiptext" + i + "'>" + list_genes[i].nom_transcrit.replace(/ /g,'').replace(/(\r\n|\n|\r)/gm, "") + "</span>"
                    newInnerHTML = innerHTML.substring(0,start) + "<span class='highlight genetotip" + i + "'>" + innerHTML.substring(start,end+1) + span +"</span>" + innerHTML.substring(end+1, innerHTML.length+1);

                }
                else {
                    span = "<span class='tooltiptext" + i + "'>" + list_genes[i].nom_transcrit.replace(/ /g,'').replace(/(\r\n|\n|\r)/gm, "") + "</span>"
                    newInnerHTML = newInnerHTML.substring(0,start) + "<span class='highlight genetotip" + i +"'> " + newInnerHTML.substring(start,end+1) +  span +"</span>" + newInnerHTML.substring(end+1, newInnerHTML.length+1);
                }
                inputText.innerHTML = newInnerHTML ;
                
            }
            
            
        }
        
        const list_genes = JSON.parse(document.getElementById('listGenes').textContent)
        //console.log(list_genes)
        highlight(list_genes)
    </script>
</html>